name: Quality Checks

on:
  pull_request:
    branches:
      - develop
      - release
      - main

jobs:
  lint-and-validate:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Validate HTML
        run: |
          echo "ðŸ” Validando HTML..."
          # Adicionar validador HTML se necessÃ¡rio
          
      - name: Validate JavaScript
        run: |
          echo "ðŸ” Validando JavaScript..."
          # Verificar sintaxe bÃ¡sica
          node -c js/config.js || exit 1
          node -c js/api.js || exit 1
          node -c js/app.js || exit 1
          echo "âœ… JavaScript OK"

      - name: Check for hardcoded credentials
        run: |
          echo "ðŸ” Verificando credenciais hardcoded..."
          # Procurar por senhas com valores literais (ex: senha: '123456')
          if grep -rE "senha\s*:\s*['\"].*['\"]" js/ --include="*.js" | grep -v "//"; then
            echo "âŒ ERRO: Credenciais hardcoded encontradas!"
            exit 1
          fi
          # Procurar por tokens/keys hardcoded
          if grep -rE "(api[_-]?key|token|password)\s*:\s*['\"].*['\"]" js/ --include="*.js" | grep -v "//"; then
            echo "âŒ ERRO: Tokens/Keys hardcoded encontrados!"
            exit 1
          fi
          echo "âœ… Nenhuma credencial hardcoded encontrada"

      - name: Check file sizes
        run: |
          echo "ðŸ“¦ Verificando tamanho dos arquivos..."
          find . -type f -size +1M -not -path "./.git/*" | while read file; do
            echo "âš ï¸  Arquivo grande: $file"
          done

      - name: Security check - manifest.json
        run: |
          echo "ðŸ›¡ï¸  Verificando manifest.json..."
          if [ -f manifest.json ]; then
            echo "âœ… Manifest encontrado"
          else
            echo "âš ï¸  Manifest nÃ£o encontrado"
          fi

      - name: Summary
        run: |
          echo "### âœ… Quality Checks Passed!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- HTML validation: âœ…" >> $GITHUB_STEP_SUMMARY
          echo "- JavaScript validation: âœ…" >> $GITHUB_STEP_SUMMARY
          echo "- Security check: âœ…" >> $GITHUB_STEP_SUMMARY
          echo "- File size check: âœ…" >> $GITHUB_STEP_SUMMARY
